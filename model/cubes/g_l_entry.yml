cubes:
  - name: g_l_entry
    sql_table: "\"BUSINESS_CENTRAL\".\"G_L_ENTRY\""
    data_source: default

    joins:
      - name: company
        sql: "{CUBE}.\"COMPANY_ID\" = {company}.\"ID\""
        relationship: many_to_one

    dimensions:
      - name: g_laccount_no
        sql: "{CUBE}.\"G_LACCOUNT_NO\""
        type: string

      - name: shortcut_dimension_7_code
        sql: "{CUBE}.\"SHORTCUT_DIMENSION_7_CODE\""
        type: string

      - name: no_series
        sql: "{CUBE}.\"NO_SERIES\""
        type: string

      - name: tax_area_code
        sql: "{CUBE}.\"TAX_AREA_CODE\""
        type: string

      - name: reversed
        sql: "{CUBE}.\"REVERSED\""
        type: boolean

      - name: gst_hst
        sql: "{CUBE}.\"GST_HST\""
        type: string

      - name: source_type
        sql: "{CUBE}.\"SOURCE_TYPE\""
        type: string

      - name: company_id
        sql: "{CUBE}.\"COMPANY_ID\""
        type: string

      - name: user_id
        sql: "{CUBE}.\"USER_ID\""
        type: string

      - name: journal_templ_name
        sql: "{CUBE}.\"JOURNAL_TEMPL_NAME\""
        type: string

      - name: shortcut_dimension_3_code
        sql: "{CUBE}.\"SHORTCUT_DIMENSION_3_CODE\""
        type: string

      - name: additional_currency_amount
        sql: "{CUBE}.\"ADDITIONAL_CURRENCY_AMOUNT\""
        type: string

      - name: quantity
        sql: "{CUBE}.\"QUANTITY\""
        type: string

      - name: prior_year_entry
        sql: "{CUBE}.\"PRIOR_YEAR_ENTRY\""
        type: boolean

      - name: system_modified_by
        sql: "{CUBE}.\"SYSTEM_MODIFIED_BY\""
        type: string

      - name: gen_bus_posting_group
        sql: "{CUBE}.\"GEN_BUS_POSTING_GROUP\""
        type: string

      - name: shortcut_dimension_5_code
        sql: "{CUBE}.\"SHORTCUT_DIMENSION_5_CODE\""
        type: string

      - name: non_deductible_vatamount
        sql: "{CUBE}.\"NON_DEDUCTIBLE_VATAMOUNT\""
        type: string

      - name: system_id
        sql: "{CUBE}.\"SYSTEM_ID\""
        type: string
        primary_key: true

      - name: fa_entry_type
        sql: "{CUBE}.\"FA_ENTRY_TYPE\""
        type: string

      - name: shortcut_dimension_6_code
        sql: "{CUBE}.\"SHORTCUT_DIMENSION_6_CODE\""
        type: string

      - name: credit_amount
        sql: "{CUBE}.\"CREDIT_AMOUNT\""
        type: string

      - name: system_created_by
        sql: "{CUBE}.\"SYSTEM_CREATED_BY\""
        type: string

      - name: global_dimension_2_code
        sql: "{CUBE}.\"GLOBAL_DIMENSION_2_CODE\""
        type: string

      - name: ste_transaction_id
        sql: "{CUBE}.\"STE_TRANSACTION_ID\""
        type: string

      - name: ic_partner_code
        sql: "{CUBE}.\"IC_PARTNER_CODE\""
        type: string

      - name: non_deductible_vatamount_acy
        sql: "{CUBE}.\"NON_DEDUCTIBLE_VATAMOUNT_ACY\""
        type: string

      - name: gen_prod_posting_group
        sql: "{CUBE}.\"GEN_PROD_POSTING_GROUP\""
        type: string

      - name: account_id
        sql: "{CUBE}.\"ACCOUNT_ID\""
        type: string

      - name: vat_bus_posting_group
        sql: "{CUBE}.\"VAT_BUS_POSTING_GROUP\""
        type: string

      - name: description
        sql: "{CUBE}.\"DESCRIPTION\""
        type: string

      - name: amount
        sql: "{CUBE}.\"AMOUNT\""
        type: string

      - name: shortcut_dimension_8_code
        sql: "{CUBE}.\"SHORTCUT_DIMENSION_8_CODE\""
        type: string

      - name: vat_prod_posting_group
        sql: "{CUBE}.\"VAT_PROD_POSTING_GROUP\""
        type: string

      - name: gen_posting_type
        sql: "{CUBE}.\"GEN_POSTING_TYPE\""
        type: string

      - name: reason_code
        sql: "{CUBE}.\"REASON_CODE\""
        type: string

      - name: add_currency_debit_amount
        sql: "{CUBE}.\"ADD_CURRENCY_DEBIT_AMOUNT\""
        type: string

      - name: document_type
        sql: "{CUBE}.\"DOCUMENT_TYPE\""
        type: string

      - name: job_no
        sql: "{CUBE}.\"JOB_NO\""
        type: string

      - name: document_no
        sql: "{CUBE}.\"DOCUMENT_NO\""
        type: string

      - name: business_unit_code
        sql: "{CUBE}.\"BUSINESS_UNIT_CODE\""
        type: string

      - name: vat_amount
        sql: "{CUBE}.\"VAT_AMOUNT\""
        type: string

      - name: external_document_no
        sql: "{CUBE}.\"EXTERNAL_DOCUMENT_NO\""
        type: string

      - name: global_dimension_1_code
        sql: "{CUBE}.\"GLOBAL_DIMENSION_1_CODE\""
        type: string

      - name: source_no
        sql: "{CUBE}.\"SOURCE_NO\""
        type: string

      - name: shortcut_dimension_4_code
        sql: "{CUBE}.\"SHORTCUT_DIMENSION_4_CODE\""
        type: string

      - name: add_currency_credit_amount
        sql: "{CUBE}.\"ADD_CURRENCY_CREDIT_AMOUNT\""
        type: string

      - name: use_tax
        sql: "{CUBE}.\"USE_TAX\""
        type: boolean

      - name: bal_account_type
        sql: "{CUBE}.\"BAL_ACCOUNT_TYPE\""
        type: string

      - name: bal_account_no
        sql: "{CUBE}.\"BAL_ACCOUNT_NO\""
        type: string

      - name: g_laccount_name
        sql: "{CUBE}.\"G_LACCOUNT_NAME\""
        type: string

      - name: source_code
        sql: "{CUBE}.\"SOURCE_CODE\""
        type: string

      - name: tax_liable
        sql: "{CUBE}.\"TAX_LIABLE\""
        type: boolean

      - name: comment
        sql: "{CUBE}.\"COMMENT\""
        type: string

      - name: journal_batch_name
        sql: "{CUBE}.\"JOURNAL_BATCH_NAME\""
        type: string

      - name: system_created_entry
        sql: "{CUBE}.\"SYSTEM_CREATED_ENTRY\""
        type: boolean

      - name: allocation_account_no
        sql: "{CUBE}.\"ALLOCATION_ACCOUNT_NO\""
        type: string

      - name: prod_order_no
        sql: "{CUBE}.\"PROD_ORDER_NO\""
        type: string

      - name: debit_amount
        sql: "{CUBE}.\"DEBIT_AMOUNT\""
        type: string

      - name: tax_group_code
        sql: "{CUBE}.\"TAX_GROUP_CODE\""
        type: string

      - name: system_created_at
        sql: "{CUBE}.\"SYSTEM_CREATED_AT\""
        type: time

      - name: vat_reporting_date
        sql: "{CUBE}.\"VAT_REPORTING_DATE\""
        type: time

      - name: last_modified_date_time
        sql: "{CUBE}.\"LAST_MODIFIED_DATE_TIME\""
        type: time

      - name: system_modified_at
        sql: "{CUBE}.\"SYSTEM_MODIFIED_AT\""
        type: time

      - name: posting_date
        sql: "{CUBE}.\"POSTING_DATE\""
        type: time

      - name: document_date
        sql: "{CUBE}.\"DOCUMENT_DATE\""
        type: time

    measures:
      - name: count
        type: count

      - name: dimension_changes_count
        sql: "{CUBE}.\"DIMENSION_CHANGES_COUNT\""
        type: sum
      
      - name: total_amount
        sql: "{CUBE}.\"AMOUNT\""
        type: sum
        
      - name: total_debit_amount
        sql: "{CUBE}.\"DEBIT_AMOUNT\""
        type: sum
        
      - name: total_credit_amount
        sql: "{CUBE}.\"CREDIT_AMOUNT\""
        type: sum
        
      - name: avg_amount
        sql: "{CUBE}.\"AMOUNT\""
        type: avg
        
      - name: max_amount
        sql: "{CUBE}.\"AMOUNT\""
        type: max
        
      - name: min_amount
        sql: "{CUBE}.\"AMOUNT\""
        type: min
        
      - name: unique_documents
        sql: "{CUBE}.\"DOCUMENT_NO\""
        type: count_distinct
        
      - name: unique_sources
        sql: "{CUBE}.\"SOURCE_NO\""
        type: count_distinct
        
      - name: unique_jobs
        sql: "{CUBE}.\"JOB_NO\""
        type: count_distinct
        
      # Period-based measures
      - name: current_period_amount
        sql: "{CUBE}.\"AMOUNT\""
        type: sum
        filters:
          - sql: "DATE_TRUNC('month', {CUBE}.\"POSTING_DATE\") = DATE_TRUNC('month', CURRENT_DATE())"
            
      - name: prior_period_amount
        sql: "{CUBE}.\"AMOUNT\""
        type: sum
        filters:
          - sql: "DATE_TRUNC('month', {CUBE}.\"POSTING_DATE\") = DATE_TRUNC('month', DATEADD('month', -1, CURRENT_DATE()))"
            
      - name: current_year_amount
        sql: "{CUBE}.\"AMOUNT\""
        type: sum
        filters:
          - sql: "YEAR({CUBE}.\"POSTING_DATE\") = YEAR(CURRENT_DATE())"
            
      - name: prior_year_amount
        sql: "{CUBE}.\"AMOUNT\""
        type: sum
        filters:
          - sql: "YEAR({CUBE}.\"POSTING_DATE\") = YEAR(CURRENT_DATE()) - 1"
            
      - name: period_over_period_change
        sql: "SUM(CASE WHEN DATE_TRUNC('month', {CUBE}.\"POSTING_DATE\") = DATE_TRUNC('month', CURRENT_DATE()) THEN {CUBE}.\"AMOUNT\" ELSE 0 END) - SUM(CASE WHEN DATE_TRUNC('month', {CUBE}.\"POSTING_DATE\") = DATE_TRUNC('month', DATEADD('month', -1, CURRENT_DATE())) THEN {CUBE}.\"AMOUNT\" ELSE 0 END)"
        type: number
        
      - name: year_over_year_change
        sql: "SUM(CASE WHEN YEAR({CUBE}.\"POSTING_DATE\") = YEAR(CURRENT_DATE()) THEN {CUBE}.\"AMOUNT\" ELSE 0 END) - SUM(CASE WHEN YEAR({CUBE}.\"POSTING_DATE\") = YEAR(CURRENT_DATE()) - 1 THEN {CUBE}.\"AMOUNT\" ELSE 0 END)"
        type: number

    pre_aggregations:
      # Pre-aggregation definitions go here.
      # Learn more in the documentation: https://cube.dev/docs/caching/pre-aggregations/getting-started

