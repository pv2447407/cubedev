cubes:
  - name: g_l_entries
    sql_table: "{{ env_var('CUBEJS_DB_NAME', 'FIVETRAN_DATABASE') | safe }}.{{ env_var('CUBEJS_DB_SNOWFLAKE_SCHEMA', 'BUSINESS_CENTRAL') | safe }}.G_L_ENTRY"
    title: General Ledger Entries
    description: Financial transactions and accounting entries
    
    joins:
      - name: g_l_accounts
        sql: "{CUBE}.G_L_ACCOUNT_NO = {g_l_accounts}.NO"
        relationship: many_to_one
        
    
    dimensions:
      - name: entry_no
        sql: ENTRY_NO
        type: number
        primary_key: true
        
      - name: g_l_account_no
        sql: G_L_ACCOUNT_NO
        type: string
        title: G/L Account No.
        
      - name: posting_date
        sql: POSTING_DATE
        type: time
        
      - name: document_type
        sql: DOCUMENT_TYPE
        type: string
        
      - name: document_no
        sql: DOCUMENT_NO
        type: string
        
      - name: description
        sql: DESCRIPTION
        type: string
        
      - name: amount
        sql: AMOUNT
        type: number
        format: currency
        
      - name: debit_amount
        sql: DEBIT_AMOUNT
        type: number
        format: currency
        
      - name: credit_amount
        sql: CREDIT_AMOUNT
        type: number
        format: currency
        
      - name: source_type
        sql: SOURCE_TYPE
        type: string
        
      - name: source_no
        sql: SOURCE_NO
        type: string
        
      - name: journal_batch_name
        sql: JOURNAL_BATCH_NAME
        type: string
        
      - name: reason_code
        sql: REASON_CODE
        type: string
        
      - name: user_id
        sql: USER_ID
        type: string
        
      - name: dimension_set_id
        sql: DIMENSION_SET_ID
        type: string
        
      - name: company_id
        sql: COMPANY_ID
        type: string
        
      - name: posting_year
        sql: "YEAR(POSTING_DATE)"
        type: number
        title: Fiscal Year
        
      - name: posting_month
        sql: "MONTH(POSTING_DATE)"
        type: number
        title: Fiscal Month
        
      - name: posting_quarter
        sql: "QUARTER(POSTING_DATE)"
        type: number
        title: Fiscal Quarter
    
    measures:
      - name: count
        type: count
        title: Total Entries
        
      - name: total_amount
        sql: AMOUNT
        type: sum
        title: Net Amount
        format: currency
        
      - name: total_debit
        sql: DEBIT_AMOUNT
        type: sum
        title: Total Debits
        format: currency
        
      - name: total_credit
        sql: CREDIT_AMOUNT
        type: sum
        title: Total Credits
        format: currency
        
      - name: balance
        sql: "SUM(DEBIT_AMOUNT) - SUM(CREDIT_AMOUNT)"
        type: number
        title: Balance
        format: currency
        
      - name: revenue_entries
        sql: AMOUNT
        type: sum
        title: Revenue
        format: currency
        filters:
          - sql: "{g_l_accounts}.INCOME_BALANCE = 'Income Statement'"
          - sql: "{g_l_accounts}.ACCOUNT_CATEGORY = 'Income'"
          
      - name: expense_entries
        sql: AMOUNT
        type: sum
        title: Expenses
        format: currency
        filters:
          - sql: "{g_l_accounts}.INCOME_BALANCE = 'Income Statement'"
          - sql: "{g_l_accounts}.ACCOUNT_CATEGORY = 'Expense'"
          
      - name: asset_entries
        sql: AMOUNT
        type: sum
        title: Assets
        format: currency
        filters:
          - sql: "{g_l_accounts}.INCOME_BALANCE = 'Balance Sheet'"
          - sql: "{g_l_accounts}.ACCOUNT_CATEGORY = 'Assets'"
          
      - name: liability_entries
        sql: AMOUNT
        type: sum
        title: Liabilities
        format: currency
        filters:
          - sql: "{g_l_accounts}.INCOME_BALANCE = 'Balance Sheet'"
          - sql: "{g_l_accounts}.ACCOUNT_CATEGORY = 'Liabilities'"
          
      - name: unique_accounts
        sql: G_L_ACCOUNT_NO
        type: count_distinct
        title: Unique Accounts Used
    
    pre_aggregations:
      - name: gl_summary_monthly
        measures:
          - count
          - total_amount
          - total_debit
          - total_credit
        dimensions:
          - document_type
          - source_type
          - company_id
        time_dimension: posting_date
        granularity: month
        refresh_key:
          every: 1 hour
          
  - name: g_l_accounts
    sql_table: "{{ env_var('CUBEJS_DB_NAME', 'FIVETRAN_DATABASE') | safe }}.{{ env_var('CUBEJS_DB_SNOWFLAKE_SCHEMA', 'BUSINESS_CENTRAL') | safe }}.G_L_ACCOUNT"
    title: Chart of Accounts
    description: General ledger account master data
    
    dimensions:
      - name: system_id
        sql: SYSTEMID
        type: string
        primary_key: true
        
      - name: no
        sql: NO
        type: string
        title: Account No.
        
      - name: name
        sql: NAME
        type: string
        title: Account Name
        
      - name: search_name
        sql: SEARCH_NAME
        type: string
        
      - name: account_type
        sql: ACCOUNT_TYPE
        type: string
        
      - name: income_balance
        sql: INCOME_BALANCE
        type: string
        title: Income/Balance
        
      - name: account_category
        sql: ACCOUNT_CATEGORY
        type: string
        
      - name: account_subcategory_descript
        sql: ACCOUNT_SUBCATEGORY_DESCRIPT
        type: string
        title: Subcategory
        
      - name: debit_credit
        sql: DEBIT_CREDIT
        type: string
        
      - name: blocked
        sql: BLOCKED
        type: boolean
        
      - name: direct_posting
        sql: DIRECT_POSTING
        type: boolean
        
      - name: reconciliation_account
        sql: RECONCILIATION_ACCOUNT
        type: boolean
        
      - name: company_id
        sql: COMPANY_ID
        type: string
    
    measures:
      - name: count
        type: count
        title: Total Accounts
        
      - name: active_accounts
        type: count
        title: Active Accounts
        filters:
          - sql: "NOT {CUBE}.BLOCKED"
          
      - name: income_accounts
        type: count
        title: Income Accounts
        filters:
          - sql: "{CUBE}.ACCOUNT_CATEGORY = 'Income'"
          
      - name: expense_accounts
        type: count
        title: Expense Accounts
        filters:
          - sql: "{CUBE}.ACCOUNT_CATEGORY = 'Expense'"
          
      - name: asset_accounts
        type: count
        title: Asset Accounts
        filters:
          - sql: "{CUBE}.ACCOUNT_CATEGORY = 'Assets'"
          
      - name: liability_accounts
        type: count
        title: Liability Accounts
        filters:
          - sql: "{CUBE}.ACCOUNT_CATEGORY = 'Liabilities'"